import Foundation

import XCTest
@testable import SmartyStreets

class USEnrichmentPrincipalResultTest: XCTestCase {
    
    var expectedJsonInput:String!
    var obj:NSDictionary!
    var sobj:String!
    var error:NSError!
    let serializer = PropertyPrincipalSerializer()
    
    override func setUp() {
        super.setUp()
        expectedJsonInput = """
        {"data_set_name":"property","data_subset_name":"principal","smarty_key":"xxx"}
        """
    
        
        sobj = """
            [{"smarty_key":"xxx","data_set_name":"property","data_subset_name":"principal","attributes":{"1st_floor_sqft":"1st_Floor_Sqft","2nd_floor_sqft":"2nd_Floor_Sqft","acres":"Acres","air_conditioner":"Air_Conditioner","arbor_pergola":"Arbor_Pergola","assessed_improvement_percent":"Assessed_Improvement_Percent","assessed_improvement_value":"Assessed_Improvement_Value","assessed_land_value":"Assessed_Land_Value","assessed_value":"Assessed_Value","assessor_last_update":"Assessor_Last_Update","assessor_taxroll_update":"Assessor_Taxroll_Update","attic_area":"Attic_Area","attic_flag":"Attic_Flag","balcony":"Balcony","balcony_area":"Balcony_Area","basement_sqft":"Basement_Sqft","basement_sqft_finished":"Basement_Sqft_Finished","basement_sqft_unfinished":"Basement_Sqft_Unfinished","bath_house":"Bath_House","bath_house_sqft":"Bath_House_Sqft","bathrooms_partial":"Bathrooms_Partial","bathrooms_total":"Bathrooms_Total","bedrooms":"Bedrooms","block1":"Block1","block2":"Block2","boat_access":"Boat_Access","boat_house":"Boat_House","boat_house_sqft":"Boat_House_Sqft","boat_lift":"Boat_Lift","bonus_room":"Bonus_Room","breakfast_nook":"Breakfast_Nook","breezeway":"Breezeway","building_definition_code":"Building_Definition_Code","building_sqft":"Building_Sqft","cabin":"Cabin","cabin_sqft":"Cabin_Sqft","canopy":"Canopy","canopy_sqft":"Canopy_Sqft","carport":"Carport","carport_sqft":"Carport_Sqft","cbsa_code":"Cbsa_Code","cbsa_name":"Cbsa_Name","cellar":"Cellar","census_block":"Census_Block","census_block_group":"Census_Block_Group","census_fips_place_code":"Census_Fips_Place_Code","census_tract":"Census_Tract","central_vacuum":"Central_Vacuum","code_title_company":"Code_Title_Company","combined_statistical_area":"Combined_Statistical_Area","community_rec":"Community_Rec","company_flag":"Company_Flag","congressional_district":"Congressional_District","construction_type":"Construction_Type","contact_city":"Contact_City","contact_crrt":"Contact_Crrt","contact_full_address":"Contact_Full_Address","contact_house_number":"Contact_House_Number","contact_mail_info_format":"Contact_Mail_Info_Format","contact_mail_info_privacy":"Contact_Mail_Info_Privacy","contact_mailing_county":"Contact_Mailing_County","contact_mailing_fips":"Contact_Mailing_Fips","contact_post_direction":"Contact_Post_Direction","contact_pre_direction":"Contact_PRE_Direction","contact_state":"Contact_State","contact_street_name":"Contact_Street_Name","contact_suffix":"Contact_Suffix","contact_unit_designator":"Contact_Unit_Designator","contact_value":"Contact_Value","contact_zip":"Contact_Zip","contact_zip4":"Contact_Zip4","courtyard":"Courtyard","courtyard_area":"Courtyard_Area","deck":"Deck","deck_area":"Deck_Area","deed_document_book":"Deed_Document_Book","deed_document_number":"Deed_Document_Number","deed_document_page":"Deed_Document_Page","deed_owner_first_name":"Deed_Owner_First_Name","deed_owner_first_name2":"Deed_Owner_First_Name2","deed_owner_first_name3":"Deed_Owner_First_Name3","deed_owner_first_name4":"Deed_Owner_First_Name4","deed_owner_full_name":"Deed_Owner_Full_Name","deed_owner_full_name2":"Deed_Owner_Full_Name2","deed_owner_full_name3":"Deed_Owner_Full_Name3","deed_owner_full_name4":"Deed_Owner_Full_Name4","deed_owner_last_name":"Deed_Owner_Last_Name","deed_owner_last_name2":"Deed_Owner_Last_Name2","deed_owner_last_name3":"Deed_Owner_Last_Name3","deed_owner_last_name4":"Deed_Owner_Last_Name4","deed_owner_middle_name":"Deed_Owner_Middle_Name","deed_owner_middle_name2":"Deed_Owner_Middle_Name2","deed_owner_middle_name3":"Deed_Owner_Middle_Name3","deed_owner_middle_name4":"Deed_Owner_Middle_Name4","deed_owner_suffix":"Deed_Owner_Suffix","deed_owner_suffix2":"Deed_Owner_Suffix2","deed_owner_suffix3":"Deed_Owner_Suffix3","deed_owner_suffix4":"Deed_Owner_Suffix4","deed_sale_date":"Deed_Sale_Date","deed_sale_price":"Deed_Sale_Price","deed_transaction_id":"Deed_Transaction_ID","depth_linear_footage":"Depth_Linear_Footage","disabled_tax_exemption":"Disabled_Tax_Exemption","document_type_description":"Document_Type_Description","driveway_sqft":"Driveway_Sqft","driveway_type":"Driveway_Type","effective_year_built":"Effective_Year_Built","elevation_feet":"138","elevator":"Elevator","equestrian_arena":"Equestrian_Arena","escalator":"Escalator","exercise_room":"Exercise_Room","exterior_walls":"Exterior_Walls","family_room":"Family_Room","fence":"Fence","fence_area":"Fence_Area","fips_code":"Fips_Code","fire_resistance_code":"Fire_Resistance_Code","fire_sprinklers_flag":"Fire_Sprinklers_Flag","fireplace":"Fireplace","fireplace_number":"Fireplace_Number","first_name":"First_Name","first_name_2":"First_Name_2","first_name_3":"First_Name_3","first_name_4":"First_Name_4","flooring":"Flooring","foundation":"Foundation","game_room":"Game_Room","garage":"Garage","garage_sqft":"Garage_Sqft","gazebo":"Gazebo","gazebo_sqft":"Gazebo_Sqft","golf_course":"Golf_Course","grainery":"Grainery","grainery_sqft":"Grainery_Sqft","great_room":"Great_Room","greenhouse":"Greenhouse","greenhouse_sqft":"Greenhouse_Sqft","gross_sqft":"Gross_Sqft","guesthouse":"Guesthouse","guesthouse_sqft":"Guesthouse_Sqft","handicap_accessibility":"Handicap_Accessibility","heat":"Heat","heat_fuel_type":"Heat_Fuel_Type","hobby_room":"Hobby_Room","homeowner_tax_exemption":"Homeowner_Tax_Exemption","instrument_date":"Instrument_Date","intercom_system":"Intercom_System","interest_rate_type_2":"Interest_Rate_Type_2","interior_structure":"Interior_Structure","kennel":"Kennel","kennel_sqft":"Kennel_Sqft","land_use_code":"Land_USE_Code","land_use_group":"Land_USE_Group","land_use_standard":"Land_USE_Standard","last_name":"Last_Name","last_name_2":"Last_Name_2","last_name_3":"Last_Name_3","last_name_4":"Last_Name_4","latitude":"Latitude","laundry":"Laundry","lean_to":"Lean_To","lean_to_sqft":"Lean_To_Sqft","legal_description":"Legal_Description","legal_unit":"Legal_Unit","lender_address":"Lender_Address","lender_address_2":"Lender_Address_2","lender_city":"Lender_City","lender_city_2":"Lender_City_2","lender_code_2":"Lender_Code_2","lender_first_name":"Lender_First_Name","lender_first_name_2":"Lender_First_Name_2","lender_last_name":"Lender_Last_Name","lender_last_name_2":"Lender_Last_Name_2","lender_name":"Lender_Name","lender_name_2":"Lender_Name_2","lender_seller_carry_back":"Lender_Seller_Carry_Back","lender_seller_carry_back_2":"Lender_Seller_Carry_Back_2","lender_state":"Lender_State","lender_state_2":"Lender_State_2","lender_zip":"Lender_Zip","lender_zip_2":"Lender_Zip_2","lender_zip_extended":"Lender_Zip_Extended","lender_zip_extended_2":"Lender_Zip_Extended_2","loading_platform":"Loading_Platform","loading_platform_sqft":"Loading_Platform_Sqft","longitude":"Longitude","lot_1":"Lot_1","lot_2":"Lot_2","lot_3":"Lot_3","lot_sqft":"Lot_Sqft","market_improvement_percent":"Market_Improvement_Percent","market_improvement_value":"Market_Improvement_Value","market_land_value":"Market_Land_Value","market_value_year":"Market_Value_Year","match_type":"match_type","media_room":"Media_Room","metro_division":"Metro_Division","middle_name":"Middle_Name","middle_name_2":"Middle_Name_2","middle_name_3":"Middle_Name_3","middle_name_4":"Middle_Name_4","milkhouse":"Milkhouse","milkhouse_sqft":"Milkhouse_Sqft","minor_civil_division_code":"Minor_Civil_Division_Code","minor_civil_division_name":"Minor_Civil_Division_Name","mobile_home_hookup":"Mobile_Home_Hookup","mortgage_amount":"Mortgage_Amount","mortgage_amount_2":"Mortgage_Amount_2","mortgage_due_date":"Mortgage_Due_Date","mortgage_due_date_2":"Mortgage_Due_Date_2","mortgage_interest_rate":"Mortgage_Interest_Rate","mortgage_interest_rate_type":"Mortgage_Interest_Rate_Type","mortgage_lender_code":"Mortgage_Lender_Code","mortgage_rate_2":"Mortgage_Rate_2","mortgage_recording_date":"Mortgage_Recording_Date","mortgage_recording_date_2":"Mortgage_Recording_Date_2","mortgage_term":"Mortgage_Term","mortgage_term_2":"Mortgage_Term_2","mortgage_term_type":"Mortgage_Term_Type","mortgage_term_type_2":"Mortgage_Term_Type_2","mortgage_type":"Mortgage_Type","mortgage_type_2":"Mortgage_Type_2","msa_code":"MSA_Code","msa_name":"MSA_Name","mud_room":"Mud_Room","multi_parcel_flag":"Multi_Parcel_Flag","name_title_company":"Name_Title_Company","neighborhood_code":"Neighborhood_Code","number_of_buildings":"Number_of_Buildings","office":"Office","office_sqft":"Office_Sqft","other_tax_exemption":"Other_Tax_Exemption","outdoor_kitchen_fireplace":"Outdoor_Kitchen_Fireplace","overhead_door":"Overhead_Door","owner_full_name":"Owner_Full_Name","owner_full_name_2":"Owner_Full_Name_2","owner_full_name_3":"Owner_Full_Name_3","owner_full_name_4":"Owner_Full_Name_4","owner_occupancy_status":"Owner_Occupancy_Status","ownership_transfer_date":"Ownership_Transfer_Date","ownership_transfer_doc_number":"Ownership_Transfer_DOC_Number","ownership_transfer_transaction_id":"Ownership_Transfer_Transaction_ID","ownership_type":"Ownership_Type","ownership_type_2":"Ownership_Type_2","ownership_vesting_relation_code":"Ownership_Vesting_Relation_Code","parcel_account_number":"Parcel_Account_Number","parcel_map_book":"Parcel_Map_Book","parcel_map_page":"Parcel_Map_Page","parcel_number_alternate":"Parcel_Number_Alternate","parcel_number_formatted":"Parcel_Number_Formatted","parcel_number_previous":"Parcel_Number_Previous","parcel_number_year_added":"Parcel_Number_Year_Added","parcel_number_year_change":"Parcel_Number_Year_Change","parcel_raw_number":"Parcel_Raw_Number","parcel_shell_record":"Parcel_Shell_Record","parking_spaces":"Parking_Spaces","patio_area":"Patio_Area","phase_name":"Phase_Name","plumbing_fixtures_count":"Plumbing_Fixtures_Count","pole_struct":"Pole_Struct","pole_struct_sqft":"Pole_Struct_Sqft","pond":"Pond","pool":"Pool","pool_area":"Pool_Area","poolhouse":"Poolhouse","poolhouse_sqft":"Poolhouse_Sqft","porch":"Porch","porch_area":"Porch_Area","poultry_house":"Poultry_House","poultry_house_sqft":"Poultry_House_Sqft","previous_assessed_value":"Previous_Assessed_Value","prior_sale_amount":"Prior_Sale_Amount","prior_sale_date":"Prior_Sale_Date","property_address_carrier_route_code":"Property_Address_Carrier_Route_Code","property_address_city":"Property_Address_City","property_address_full":"Property_Address_Full","property_address_house_number":"Property_Address_House_Number","property_address_post_direction":"Property_Address_Post_Direction","property_address_pre_direction":"Property_Address_PRE_Direction","property_address_state":"Property_Address_State","property_address_street_name":"Property_Address_Street_Name","property_address_street_suffix":"Property_Address_Street_Suffix","property_address_unit_designator":"Property_Address_Unit_Designator","property_address_unit_value":"Property_Address_Unit_Value","property_address_zip_4":"Property_Address_Zip_4","property_address_zipcode":"Property_Address_Zipcode","publication_date":"Publication_Date","quarter":"Quarter","quarter_quarter":"Quarter_Quarter","quonset":"Quonset","quonset_sqft":"Quonset_Sqft","range":"Range","recording_date":"Recording_Date","roof_cover":"Roof_Cover","roof_frame":"Roof_Frame","rooms":"Rooms","rv_parking":"Rv_Parking","safe_room":"Safe_Room","sale_amount":"Sale_Amount","sale_date":"Sale_Date","sauna":"Sauna","section":"Section","security_alarm":"Security_Alarm","senior_tax_exemption":"Senior_Tax_Exemption","sewer_type":"Sewer_Type","shed":"Shed","shed_sqft":"Shed_Sqft","silo":"Silo","silo_sqft":"Silo_Sqft","sitting_room":"Sitting_Room","situs_county":"Situs_County","situs_state":"Situs_State","sound_system":"Sound_System","sports_court":"Sports_Court","sprinklers":"Sprinklers","stable":"Stable","stable_sqft":"Stable_Sqft","storage_building":"Storage_Building","storage_building_sqft":"Storage_Building_Sqft","stories_number":"Stories_Number","storm_shelter":"Storm_Shelter","storm_shutter":"Storm_Shutter","structure_style":"Structure_Style","study":"Study","subdivision":"Subdivision","suffix":"Suffix","suffix_2":"Suffix_2","suffix_3":"Suffix_3","suffix_4":"Suffix_4","sunroom":"Sunroom","tax_assess_year":"Tax_Assess_Year","tax_billed_amount":"Tax_Billed_Amount","tax_delinquent_year":"Tax_Delinquent_Year","tax_fiscal_year":"Tax_Fiscal_Year","tax_jurisdiction":"Tax_Jurisdiction","tax_rate_area":"Tax_Rate_Area","tennis_court":"Tennis_Court","topography_code":"Topography_Code","total_market_value":"Total_Market_Value","township":"Township","tract_number":"Tract_Number","transfer_amount":"Transfer_Amount","trust_description":"Trust_Description","unit_count":"Unit_Count","upper_floors_sqft":"Upper_Floors_Sqft","utility":"Utility","utility_building":"Utility_Building","utility_building_sqft":"Utility_Building_Sqft","utility_sqft":"Utility_Sqft","veteran_tax_exemption":"Veteran_Tax_Exemption","view_description":"View_Description","water_feature":"Water_Feature","water_service_type":"Water_Service_Type","wet_bar":"Wet_Bar","widow_tax_exemption":"Widow_Tax_Exemption","width_linear_footage":"Width_Linear_Footage","wine_cellar":"Wine_Cellar","year_built":"Year_Built","zoning":"Zoning"}}]

        """
        self.error = nil
    }
    
    override func tearDown() {
        super.tearDown()
        self.error = nil
    }
    
    func testLookupSerialization() {
        let lookup = PropertyPrincipalEnrichmentLookup(smartyKey: "xxx")
        let actualBytes = serializer.Serialize(obj: lookup, error: &self.error)
        
        let data = Data(base64Encoded: (actualBytes?.base64EncodedString())!)
        let string = String(data: data!, encoding: .utf8)
        XCTAssertNil(self.error)
        XCTAssertEqual(string, expectedJsonInput)
    }
    
    func testAllFieldsFilledCorrectly() throws {
        let data = sobj.data(using: .utf8)
        // Convert the JSON string to a JSON object
        let jsonObject = try JSONSerialization.jsonObject(with: data!, options: []) as? [[String: Any]]
        // Convert the JSON object to JSON data
        let jsonData = try JSONSerialization.data(withJSONObject: jsonObject!, options: .prettyPrinted)
       
       // Deserialize the JSON data
        let results = serializer.Deserialize(payload: jsonData, error: &self.error) as? [PrincipalResult]
        print(results!)
        let result = results![0]
        
        XCTAssertEqual("xxx", result.smartyKey)

        let _ = result.attributes
        
    }
}
